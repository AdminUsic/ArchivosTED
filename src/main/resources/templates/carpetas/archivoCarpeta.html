<div>
    <div class="modal-header ">
        <ol class="breadcrumb float-sm-right text-center">
            <li class="breadcrumb-item active text-center" th:text="'   '+${carpeta.volumen.nombre}"></li>
            <li class="breadcrumb-item active text-center" th:text="'Unidad: ' + ${carpeta.unidad.nombre}"></li>
            <li class="breadcrumb-item active text-center"
                th:text="'Serie Documental: ' + ${carpeta.serieDocumental.nombre}"></li>
            <li class="breadcrumb-item active text-center" th:text="'Gestion: ' + ${carpeta.Gestion}"></li>
        </ol>
        <a type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Cerrar" onclick="cancelarMod()"></a>
    </div>
    <div class="modal-body">
        <div class="container-fluid" id="body-Carpeta">
            <div class="card card-info">
                <div class="container">
                    <div class="content-header">
                        <div class="container-fluid">
                            <div class="row mb-2">
                                <div class="col-sm-6">
                                    <h4 th:if="${carpeta.TotalArchivo == 0}">Esta carpeta contiene no contiene ninguna
                                        hoja</h4>
                                    <h4 th:if="${carpeta.TotalArchivo > 0}"
                                        th:text="(${carpeta.TotalArchivo} > 1) ? 'Esta carpeta contiene ' + ${carpeta.TotalArchivo} + ' hojas en total' : 'Contiene ' + ${carpeta.TotalArchivo} + ' hoja en total'">
                                    </h4>
                                </div><!-- /.col -->
                                <div class="col-sm-6">
                                    <ol class="breadcrumb float-sm-right">
                                        <div class="btn-group">
                                            <a class="btn btn-success" type="button" id="botonAgregarArchivo"
                                                th:attr="onclick='AñadirArchivo(\'' + ${carpeta.id_carpeta} + '\')'"
                                                th:if="${#lists.contains(permisos.![nombre], 'registrar_archivo')}">
                                                Agregar Archivo <li class="fa-solid fa-file-circle-plus"></li>
                                            </a>
                                        </div>
                                    </ol>
                                </div>
                                <!-- /.col -->
                            </div><!-- /.row -->
                        </div><!-- /.container-fluid -->
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="card-box">
                                <div class="row">
                                    <div class="col-sm-3" th:if="${carpeta.archivos.size > 0}">
                                        <div id="myBtnContainer" class="panel panel-dark-outline tabs-panel">
                                            <div class="panel-heading">
                                                <ul class="nav nav-tabs pull-left type-document">
                                                </ul>
                                            </div>
                                            <h4 class="no-margin-top"><a type="button" class="effect-underline"
                                                    style="text-decoration: none;"
                                                    onclick="filterSelection('all')">Lista de
                                                    Archivos</a></h4>
                                            <div class="panel-body tab-content">
                                                <div class="tab-pane active documents-panel">
                                                    <ul class="folders list-unstyled" id="menuList">
                                                        <div th:each="subSeries: ${carpeta.serieDocumental.subSeries}">
                                                            <h6 class="no-margin-top">
                                                                <a type="button" class="effect-underline "
                                                                    style="text-decoration: none;"
                                                                    th:attr="onclick='filterSelection(\'' +${subSeries.nombre} + '\')'"
                                                                    th:text="${subSeries.nombre}"></a>
                                                            </h6>
                                                            <li th:each="listArchivos: ${subSeries.archivos}"
                                                                th:if="${listArchivos.carpeta.id_carpeta == carpeta.id_carpeta}">
                                                                <div class="dropdown ">
                                                                    <a class="dropdown-toggle seleccionarArchivo"
                                                                        style="width: 100%;" data-mdb-toggle="dropdown"
                                                                        aria-expanded="false" type="button">
                                                                        <i class="fa fa-file"></i>
                                                                        <small
                                                                            th:text="'    '+${listArchivos.nombre}"></small>
                                                                    </a>
                                                                    <ul class="dropdown-menu ">
                                                                        <a class="dropdown-item" type="button"
                                                                            th:if="${listArchivos.contenido != null}"
                                                                            data-mdb-dismiss="modal"
                                                                            data-mdb-toggle="modal"
                                                                            data-mdb-target="#archivoModal"
                                                                            th:attr="onclick='ContenidoArchivo(\'' + ${listArchivos.id_archivo} + '\')'">
                                                                            <i
                                                                                class="fa-regular fa-file-pdf"></i><small>
                                                                                Ver Archivo</small>
                                                                        </a>
                                                                        <a class="dropdown-item" type="button"
                                                                            th:attr="onclick='ModificarArchivo(\'' + ${listArchivos.id_archivo} + '\')'"
                                                                            th:if="${#lists.contains(permisos.![nombre], 'editar_archivo')}">
                                                                            <i class="fas fa-pencil-alt"></i><small>Editar
                                                                                Archivo</small></a>
                                                                        <a class="dropdown-item" type="button"
                                                                            th:attr="onclick='EliminarArchivoIco(\'' + ${listArchivos.id_archivo} + '\', \'' + ${listArchivos.carpeta.id_carpeta} + '\', \'' + ${listArchivos.nombre} + '\')'"
                                                                            th:if="${#lists.contains(permisos.![nombre], 'eliminar_archivo')}">
                                                                            <i class="fas fa-trash"></i><small> Eliminar
                                                                                Archivo</small></a>
                                                                    </ul>
                                                                </div>
                                                            </li>
                                                        </div>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="container col-md flex-grow-1">
                                        <div class="row" th:each="subSeries: ${carpeta.serieDocumental.subSeries}"
                                            th:if="${carpeta.archivos.size > 0}">
                                            <h5 th:class="'filterTitulo '+${subSeries.nombre} "
                                                th:text="${subSeries.nombre}"></h5>

                                            <div th:class="'document document.success filterDiv '+${subSeries.nombre}"
                                                style="background-color: #6e7072; padding: 1px;"
                                                th:each="arch:${subSeries.archivos}"
                                                th:if="${arch.estado!='X'} and ${arch.carpeta.id_carpeta == carpeta.id_carpeta}">
                                                <div class="position-absolute top-0 end-0 m-2 d-flex justify-content-end"
                                                    th:if="${#lists.contains(permisos.![nombre], 'editar_archivo') or #lists.contains(permisos.![nombre], 'eliminar_archivo')}">
                                                    <div class="btn-group">
                                                        <a class="btn btn-sm btn-info file-close" style="color: white;"
                                                            type="button"
                                                            th:attr="onclick='ModificarArchivo(\'' + ${arch.id_archivo} + '\')'"
                                                            th:if="${#lists.contains(permisos.![nombre], 'editar_archivo')}">
                                                            <i class="fas fa-pencil-alt"></i>
                                                        </a>
                                                        <a class="btn btn-sm btn-danger file-close"
                                                            style="color: white;" type="button"
                                                            th:attr="onclick='EliminarArchivoIco(\'' + ${arch.id_archivo} + '\',\'' + ${arch.carpeta.id_carpeta} + '\', \'' + ${arch.nombre} + '\')'"
                                                            th:if="${#lists.contains(permisos.![nombre], 'eliminar_archivo')}">
                                                            <i class="fas fa-trash"></i>
                                                        </a>
                                                    </div>
                                                </div>

                                                <div class="document-body">
                                                    <i>
                                                        <th:block th:if="${arch.contenido == null}">
                                                            <a type="button" onclick="mensajeSinDocumento()">
                                                                <i class="fa-solid fa-file-circle-xmark"></i>
                                                            </a>
                                                        </th:block>
                                                        <th:block th:if="${arch.contenido != null}">
                                                            <a type="button" data-mdb-dismiss="modal"
                                                                data-mdb-toggle="modal" data-mdb-target="#archivoModal"
                                                                th:attr="onclick='ContenidoArchivo(\'' + ${arch.id_archivo} + '\')'">
                                                                <img th:src="@{'/verIcoPdf/' + ${arch.id_archivo}}"
                                                                    class="img-fluid mb-2" alt="Ver Archivo?" />
                                                            </a>
                                                        </th:block>
                                                    </i>
                                                </div>
                                                <div class="document-footer" style="height: 100%;">
                                                    <span class="document-name" th:text="${arch.nombre}"></span>
                                                    <span class="document-name"
                                                        th:text="'Usuario: '+${arch.persona.nombre}+' '+${arch.persona.apellido}"></span>
                                                    <span class="document-name"
                                                        th:text="'Cant. Hojas: '+${arch.cantidadHojas}"></span>
                                                    <!-- <span class="document-name"
                                                        th:text="'Emisión: ' + ${#dates.format(arch.fechaEmision, 'dd/MM/yyyy')}"></span> -->
                                                    <th:block
                                                        th:if="${userLog.persona.cargo.nombre == 'ARCHIVO Y BIBLIOTECA'}">
                                                        <span class="document-name"
                                                            th:text="'Ubicacion: '+ ${arch.rutaFisica}"></span>
                                                    </th:block>
                                                </div>
                                            </div>
                                            <!-- </div> -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .image-container {
            position: relative;
            display: inline-block;
            overflow: hidden;
            width: 120px;
            height: 120px;
        }

        .image-container img {
            transition: transform 0.3s;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-container:hover img {
            transform: scale(1.2);
        }

        .filterTitulo {
            float: left;
            text-align: center;
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .filterDiv {
            display: none;
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .show {
            display: block;
            opacity: 1;
            transform: translateY(0);
            transform: scale(1);
        }

        .effect-underline:after {
            content: '';
            position: absolute;
            left: 0;
            display: inline-block;
            height: 1em;
            width: 100%;
            border-bottom: 1px solid;
            margin-top: 10px;
            opacity: 0;
            -webkit-transition: opacity 0.35s, -webkit-transform 0.35s;
            transition: opacity 0.35s, transform 0.35s;
            -webkit-transform: scale(0, 1);
            transform: scale(0, 1);
        }

        .effect-underline:hover:after {
            opacity: 1;
            -webkit-transform: scale(1);
            transform: scale(1);
        }
    </style>

    <script>
        $(document).ready(function () {
            $('#searchInput').on('input', function () {
                var searchText = $(this).val().toLowerCase();
                $('.image-container').each(function () {
                    var altText = $(this).find('.image').attr('alt').toLowerCase();
                    if (altText.includes(searchText)) {
                        $(this).removeClass('hide');
                    } else {
                        $(this).addClass('hide');
                    }
                });
            });
        });

        filterSelection("all");

        function filterSelection(c) {
            var x, i, t;
            x = document.getElementsByClassName("filterDiv");
            t = document.getElementsByClassName("filterTitulo");
            if (c == "all") c = "";
            // Agrega la clase "show" (display:block) a los elementos filtrados y elimina la clase "show" de los elementos que no están seleccionados
            for (i = 0; i < x.length; i++) {
                w3RemoveClass(x[i], "show");
                if (x[i].className.indexOf(c) > -1) w3AddClass(x[i], "show");
            }

            if (c == "all") c = "";
            // Agrega la clase "show" (display:block) a los elementos filtrados y elimina la clase "show" de los elementos que no están seleccionados
            for (i = 0; i < t.length; i++) {
                w3RemoveClass(t[i], "show");
                if (t[i].className.indexOf(c) > -1) w3AddClass(t[i], "show");
            }
        }

        // Muestra elementos filtrados
        function w3AddClass(element, name) {
            var i, arr1, arr2;
            arr1 = element.className.split(" ");
            arr2 = name.split(" ");
            for (i = 0; i < arr2.length; i++) {
                if (arr1.indexOf(arr2[i]) == -1) {
                    element.className += " " + arr2[i];
                    // Agregar este bloque para el efecto de zoom
                    setTimeout(() => {
                        element.style.opacity = 1;
                        element.style.transform = "scale(1)";
                    }, 10);
                }
            }
        }

        function w3RemoveClass(element, name) {
            var i, arr1, arr2;
            arr1 = element.className.split(" ");
            arr2 = name.split(" ");
            for (i = 0; i < arr2.length; i++) {
                while (arr1.indexOf(arr2[i]) > -1) {
                    arr1.splice(arr1.indexOf(arr2[i]), 1);
                }
            }
            element.className = arr1.join(" ");
            // Restablece la animación al quitar la clase
            element.style.opacity = 0;
            element.style.transform = "scale(0.8)";
        }


    </script>
    <script>
        function EliminarArchivoIco(id, id_carpeta, nombre) {
            Swal.fire({
                title: '!Atención¡',
                text: '¿Estas Seguro que desea eliminar el archivo " ' + nombre + ' "?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, eliminar!'
            }).then((result) => {
                if (result.isConfirmed) {

                    $.ajax({
                        type: 'POST',
                        url: "/EliminarRegistroArchivo/" + id,
                        success: function (response) {
                            if (response == 'elimina') {
                                AbrirCarpeta(id_carpeta);
                                cargarRegistroIco();
                                Swal.fire(
                                    'Eliminado!',
                                    'Este registro se ha eliminado con éxito.',
                                    'success'
                                );
                            } else {
                                Swal.fire(
                                    'Imposible continuar!',
                                    response,
                                    'error'
                                );
                            }
                        }, error: function (xhr, status, error) {
                            console.log(error);
                        }
                    });

                }
            });
        }

        function eliminarArchivoSeleccionadoIco(id, id_carpeta) {
            $.ajax({
                type: 'POST',
                url: "/EliminarRegistroArchivo/" + id,  // Ruta del metodo del controlador en Spring Boot
                success: function (response) {

                    AbrirCarpeta(id_carpeta);
                    cargarRegistroIco();
                    Swal.close();
                    toastr.error('Se ha Eliminado un Registro');
                }, error: function (xhr, status, error) {
                    // Maneja los errores de la solicitud AJAX
                    console.log(error);
                }
            });
        }

        function mensajeSinDocumento() {
            Swal.fire(
                'Sin Contenido!',
                'Este registro no tiene el contenido de un documento digitalizado.',
                'warning'
            );
        }
    </script>
</div>
<style>
    .seleccionarArchivo:hover {
        /* Cambiar el color de fondo al pasar el ratón por encima */
        background-color: #0A58CA;
        /* Cambia este color según tus preferencias */
        color: #ffffff;
        /* Agregar una transición suave para un efecto más atractivo */
        transition: background-color 0.3s ease;
        /* Agregar sombra para un efecto de elevación */
        box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.1);
        /* Ajusta según tus preferencias */
        border-radius: 4px;
    }

    /* Cambiar el color del texto cuando el botón está en hover */
    .seleccionarArchivo:hover i {
        color: #ffffff;
        /* Cambia este color según tus preferencias */
        /* Agregar una transición suave para el cambio de color */
        transition: color 0.3s ease;
        border-radius: 4px;
    }
</style>